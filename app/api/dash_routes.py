from types import new_class
from typing import Dict
from flask import Blueprint, jsonify, session, request
from requests.models import ReadTimeoutError
from flask_login import login_required
from app.models import User, Stock, Portfolio, Transaction, Watchlist, List, transaction
import requests, json
import pyEX as p
import pprint

# API_KEY=pk_7f972a2636b841c489f3cf32f9a06575

dashboard_routes = Blueprint('dashboard', __name__)

# c = p.Client(api_token='pk_7f972a2636b841c489f3cf32f9a06575', version='stable')

@dashboard_routes.route('/stockinfo/<int:user>', methods=['POST'])
# @login_required
def stock(user):
    print(user)
    # stocks = request.json['stock']
    stocks = []
    temp = Transaction.query.filter_by(user_id=user).all()
    for i in range(len(temp)):
        temp2 = temp[i].to_dict()
        stocks.append(temp2['stock_id']['ticker'])
        # print(temp[i].to_dict())
    print(stocks)

    def get_latest_updates(symbols):
        seperator = ','
        # print(seperator.join(symbols))

        # https://reactjs.org/docs/code-splitting.html


        # iex_api_key = 'pk_7f972a2636b841c489f3cf32f9a06575'
        # api_url = f'https://cloud.iexapis.com/stable/stock/market/batch?symbols={seperator.join(symbols)}&types=chart&range=1m&token={iex_api_key}'
        # df = requests.get(api_url).json()
        # print(df)
        # pp = pprint.PrettyPrinter(indent=4)
        # pp.pprint(df)

        # iex_api_key = 'pk_7f972a2636b841c489f3cf32f9a06575'
        # api_url = f'https://cloud.iexapis.com/stable/stock/market/batch?symbols={seperator.join(symbols)}&types=chart&filter=close&range=1m&token={iex_api_key}'
        # df = requests.get(api_url).json()
        # pp = pprint.PrettyPrinter(indent=4)
        # pp.pprint(df)
        # print(df)


        # prices = {'1d': [],'2d': [], '3d': [], '4d': [], '5d': []}

        # FIX BEFORE PRODCUTION

        prices = {'1d': [], '5d': [], '1m': [], '1y': [], '5y': []}

        # for i in symbols:
        #     ticker = i

        # FIX FOR PRODUCTION

        attributes = ['1d',
                    '5d',
                    '1m',
                    '1y',
                    '5y']

            # attributes = ['1d',
            #         '2d',
            #         '3d',
            #         '4d',
            #         '5d',]


        for date_range in attributes:

            iex_api_key = 'pk_7f972a2636b841c489f3cf32f9a06575'
            api_url = f'https://cloud.iexapis.com/stable/stock/market/batch?symbols={seperator.join(symbols)}&types=chart&filter=close&range={date_range}&token={iex_api_key}'
            df = requests.get(api_url).json()

            for symbol in symbols:
                if len(prices[date_range]) == 0:
                    for i in range(len(df[symbol]['chart'])):
                        prices[date_range].append(df[symbol]['chart'][i]['close'])

                elif len(prices[date_range]):
                    for i in range(len(prices[date_range])):
                        if prices[date_range][i] == None:
                            prices[date_range][i] = df[symbol]['chart'][i]['close']
                        elif df[symbol]['chart'][i]['close'] == None:
                            continue
                        else:
                            prices[date_range][i] += df[symbol]['chart'][i]['close']



        return prices


    response = get_latest_updates(stocks)
    print(response)
    return response


# {'1d': [245.25, 244.69, 244.62, 244.74, 244.76, 244.87, 244.7, 244.72, 244.47, 244.725, 244.92999999999998, 244.87, 244.79000000000002, 245.08, 245.02, 244.61, 244.71, 244.575, 244.39499999999998, 244.285, 244.395, 244.57, 244.83999999999997, 244.86999999999998, 245.03, 244.85500000000002, 245.015, 245.035, 245.12, 245.185, 245.115, 245.14499999999998, 245.225, 245.37999999999997, 245.19, 245.22500000000002, 245.7, 245.82, 245.74, 245.57, 245.81, 245.83, 245.66, 245.7, 245.87, 245.93, 245.79, 245.865, 245.82999999999998, 245.42, 245.28000000000003, 245.28, 245.465, 245.51500000000001, 245.33, 245.16000000000003, 244.93, 244.845, 244.8, 244.82999999999998, 245.045, 245.29999999999998, 245.41500000000002, 245.35000000000002, 245.71, 245.69, 245.69, 245.79000000000002, 245.72, 245.79, 245.7, 245.85500000000002, 245.815, 245.665, 245.54000000000002, 245.42, 245.265, 245.13000000000002, 245.055, 244.89, 244.78, 244.935, 244.95499999999998, 244.95, 244.84999999999997, 244.945, 245.0, 244.955, 244.78, 244.79, 245.005, 245.0, 244.935, 244.78000000000003, 244.745, 244.635, 244.745, 244.875, 244.82000000000002, 183.07, 245.1, 245.17000000000002, 245.155, 245.07, 245.04, 245.10000000000002, 244.925, 245.05, 245.17000000000002, 245.19, 183.105, 245.31, 245.275, 245.375, 245.355, 245.39000000000001, 245.29999999999998, 245.125, 245.165, 245.35999999999999, 245.345, 245.385, 245.375, 245.26000000000002, 245.285, 245.29999999999998, 245.27499999999998, 245.395, 245.48000000000002, 245.45000000000002, 245.24, 245.15500000000003, 245.10500000000002, 245.08499999999998, 245.06, 245.04, 245.195, 245.29000000000002, 245.14, 245.18499999999997, 245.14000000000001, 245.17499999999998, 245.08499999999998, 245.1, 245.12, 245.185, 183.305, 245.22, 245.175, 245.23999999999998, 245.22, 245.265, 245.265, 245.26000000000002, 245.34500000000003, 245.39, 245.43, 245.44, 245.44, 245.38, 245.31, 245.51, 245.675, 245.73999999999998, 245.67, 245.70499999999998, 245.76, 245.74, 187.37, 245.75, 245.74, 245.72500000000002, 245.67000000000002, 245.725, 245.66, 245.67999999999998, 245.625, 245.64, 245.67000000000002, 245.755, 245.71500000000003, 245.73000000000002, 245.82, 183.595, 245.78, 245.88000000000002, 245.88, 245.91, 245.9, 245.92000000000002, 245.88, 245.97, 245.94500000000002, 245.97500000000002, 246.03000000000003, 246.07, 246.175, 246.13, 246.07, 246.0, 246.0, 246.01, 246.09, 246.1, 246.0, 246.00000000000003, 183.615, 246.13, 246.12, 246.15500000000003, 246.22000000000003, 246.20000000000002, 246.225, 246.435, 246.36499999999998, 246.32, 246.33499999999998, 246.225, 246.16, 246.05499999999998, 246.01000000000002, 246.04, 245.89999999999998, 245.83999999999997, 245.76999999999998, 245.67, 245.575, 245.57, 245.595, 245.53, 245.475, 245.36, 245.39999999999998, 245.32999999999998, 245.275, 245.225, 245.17, 245.245, 245.065, 244.99, 245.29, 245.35500000000002, 183.245, 245.34, 245.435, 245.42000000000002, 245.315, 245.22, 245.29, 245.205, 245.14000000000001, 245.28, 245.36, 245.35000000000002, 245.48, 245.31, 245.34, 245.32, 245.27499999999998, 245.36999999999998, 245.345, 245.37, 245.375, 245.4, 245.38500000000002, 245.31, 245.37, 245.415, 245.475, 245.365, 245.32999999999998, 245.46499999999997, 245.54, 245.71, 245.76, 245.755, 245.67, 245.685, 245.47500000000002, 245.52, 245.525, 245.29000000000002, 245.44, 245.47, 245.395, 245.445, 245.495, 245.47, 245.59, 245.565, 245.64, 245.67, 245.70499999999998, 245.69, 245.695, 245.655, 245.695, 245.79500000000002, 245.775, 245.835, 245.695, 245.745, 245.685, 245.6, 245.675, 245.66500000000002, 245.63000000000002, 245.62, 245.535, 245.57, 245.61, 245.67, 245.725, 245.73000000000002, 245.77, 187.455, 245.75, 245.71, 245.71, 245.69500000000002, 245.76, 245.725, 245.725, 245.675, 245.76, 187.445, 245.765, 245.655, 245.74, 245.79, 245.775, 245.685, 245.7, 245.58999999999997, 245.665, 245.67999999999998, 245.655, 245.625, 187.34, 245.60500000000002, 245.48000000000002, 245.255, 245.415, 245.435, 245.445, 245.43, 245.49, 245.42000000000002, 245.42000000000002, 245.49499999999998, 245.45999999999998, 245.365, 245.29000000000002, 245.31, 245.26500000000001, 245.215, 245.16, 245.255, 245.31, 245.26, 245.32, 245.4, 245.17999999999998, 245.21, 245.175, 245.185, 245.27999999999997, 245.405, 245.44, 245.485, 245.575, 245.495, 245.41, 245.315, 245.28, 245.36, 245.35500000000002, 245.395, 245.5, 245.49, 245.34500000000003, 245.465, 245.32999999999998, 245.37000000000003, 245.04, 244.91, 245.035, 244.89, 244.70999999999998, 244.74], '5d': [245.29, 244.43, 244.73], '1m': [248.5, 246.28999999999996, 238.03, 235.73, 236.14000000000001, 238.70000000000002, 230.8, 232.07999999999998, 225.02999999999997, 226.04000000000002, 232.17, 232.78, 231.39999999999998, 231.51999999999998, 239.09, 236.49, 244.28, 243.05, 245.29, 244.43, 244.73], '1y': [131.9025, 132.845, 135.89000000000001, 133.56, 138.075, 140.65499999999997, 143.0075, 144.55, 136.715, 138.28, 140.60750000000002, 143.54999999999998, 144.0575, 143.9525, 143.5, 146.3875, 148.21249999999998, 145.375, 147.06, 140.5275, 143.025, 144.48, 145.5575, 145.1175, 149.22250000000003, 150.9725, 157.1625, 157.3425, 156.85, 153.5675, 155.1775, 157.935, 155.7025, 156.6775, 160.6875, 158.75, 157.4125, 153.255, 152.30499999999998, 154.5, 152.4525, 155.1, 155.32, 165.08, 166.5475, 167.775, 168.55249999999998, 172.9425, 169.83249999999998, 172.1875, 168.255, 172.31, 174.73, 174.4975, 174.3675, 175.3425, 176.51749999999998, 179.06500000000003, 185.23, 187.2175, 186.495, 188.96249999999998, 187.14, 188.1875, 192.20999999999998, 197.74, 198.60000000000002, 185.70999999999998, 183.27, 173.7, 180.53, 175.75, 175.12, 178.25500000000002, 179.1, 176.59, 173.99, 170.81, 173.86, 180.01, 177.82, 175.68, 180.81, 184.85, 184.82000000000002, 186.42000000000002, 190.26999999999998, 185.78, 191.35, 185.48999999999998, 187.62, 188.03, 189.87, 199.61, 195.1, 194.48999999999998, 194.79999999999998, 192.66, 190.46, 192.31, 203.61, 205.0, 208.65, 205.32, 209.41, 202.59, 209.97, 189.61, 189.03, 193.34, 199.7, 204.29, 207.19, 200.60999999999999, 196.92, 201.57999999999998, 202.32, 203.17, 202.10999999999999, 201.51, 201.99, 204.55, 206.31, 204.04999999999998, 204.69, 208.02, 209.21, 209.98, 213.89, 217.79999999999998, 218.67999999999998, 218.07999999999998, 221.1, 221.81, 218.16, 227.6, 227.18, 225.4, 232.04999999999998, 233.49, 236.57999999999998, 235.51500000000001, 235.22999999999996, 238.88, 237.0, 236.09, 239.38, 240.45999999999998, 237.39999999999998, 236.91, 233.53, 235.2, 229.67999999999998, 235.69, 236.26, 231.54, 232.29, 231.54, 223.73, 222.63, 224.15, 231.83, 238.39000000000001, 240.7, 244.41, 246.12, 239.2, 241.79, 235.43, 243.64999999999998, 247.86, 247.77999999999997, 252.20999999999998, 257.17999999999995, 258.89, 258.68, 265.76, 265.91999999999996, 269.24, 269.96, 265.35, 264.84000000000003, 267.66999999999996, 259.9, 269.48, 266.74, 258.84000000000003, 263.98, 272.09000000000003, 263.3, 252.94, 244.59, 245.8, 232.73, 244.90499999999997, 239.88, 250.03999999999996, 251.82, 258.01, 257.04999999999995, 258.91, 245.74, 244.57999999999998, 246.76, 242.07, 232.66, 233.2, 234.07, 233.9, 232.5, 238.07, 241.32, 244.25, 250.09, 257.12, 264.78, 267.45500000000004, 264.54, 269.32, 263.78, 270.09999999999997, 265.53, 263.22, 257.3, 259.13, 253.3, 262.64, 261.46000000000004, 260.90999999999997, 261.32, 260.85, 248.5, 246.28999999999996, 238.03, 235.73, 236.14000000000001, 238.70000000000002, 230.8, 232.07999999999998, 225.02999999999997, 226.04000000000002, 232.17, 232.78, 231.39999999999998, 231.51999999999998, 239.09, 236.49, 244.28, 243.05, 245.29, 244.43, 244.73], '5y': [64.665, 66.725, 63.400000000000006, 61.120000000000005, 62.7375, 62.4675, 61.754999999999995, 60.6025, 59.30749999999999, 59.655, 59.614999999999995, 59.785000000000004, 60.18749999999999, 60.3125, 61.935, 63.4275, 62.75749999999999, 64.895, 62.0, 61.400000000000006, 62.0475, 62.96, 63.16, 63.3925, 61.5875, 61.6525, 62.175, 63.22, 62.655, 62.675000000000004, 62.147499999999994, 62.597500000000004, 63.325, 64.22749999999999, 64.44749999999999, 64.48, 64.4475, 64.375, 64.565, 64.6275, 64.0575, 64.605, 64.6825, 64.9725, 65.13, 67.2475, 67.0575, 68.45, 68.27250000000001, 63.9325, 65.18, 67.5025, 67.36500000000001, 68.13, 68.01499999999999, 67.475, 66.35, 66.35000000000001, 66.2075, 67.8325, 66.47749999999999, 66.6625, 66.245, 66.515, 65.97, 65.945, 66.5425, 66.0425, 65.70500000000001, 65.04, 63.28, 61.9925, 62.38999999999999, 61.7475, 63.5625, 65.07249999999999, 65.15, 64.025, 64.4225, 64.41749999999999, 64.575, 68.1375, 69.35000000000001, 69.8825, 69.2175, 68.64500000000001, 68.6325, 69.44, 68.95, 70.1225, 63.8125, 63.605000000000004, 62.2625, 62.345, 62.515, 61.765, 61.25749999999999, 61.00750000000001, 60.677499999999995, 60.43, 60.055, 60.64, 61.4425, 60.63250000000001, 59.8575, 59.12, 58.739999999999995, 59.265, 58.88249999999999, 58.8975, 58.0575, 58.790000000000006, 59.7825, 57.974999999999994, 59.45, 58.057500000000005, 58.7775, 58.9175, 59.7675, 59.707499999999996, 60.567499999999995, 61.33500000000001, 61.0625, 61.36, 61.2175, 60.9975, 61.1525, 60.565, 60.39, 59.8925, 59.905, 60.6575, 61.057500000000005, 62.50750000000001, 62.800000000000004, 63.1675, 62.165, 63.417500000000004, 62.6475, 62.464999999999996, 61.7825, 61.17, 60.8575, 59.565, 59.3925, 59.75, 60.375, 60.120000000000005, 60.4525, 59.894999999999996, 60.00750000000001, 60.345, 61.0325, 61.3575, 61.5875, 63.1275, 63.787499999999994, 63.692499999999995, 63.08, 63.050000000000004, 62.8575, 61.985, 62.14, 61.6, 61.10249999999999, 61.36, 61.685, 62.4975, 63.0275, 63.2975, 63.9375, 64.4625, 65.15, 65.3325, 66.2625, 64.64, 61.894999999999996, 61.37, 61.5325, 62.845, 63.0775, 62.746300000000005, 63.540000000000006, 63.004999999999995, 62.697500000000005, 62.7825, 63.114999999999995, 63.352500000000006, 63.6275, 64.4375, 64.31, 64.565, 63.965, 65.0, 64.59, 64.59, 64.975, 66.22999999999999, 65.9975, 66.105, 66.4025, 65.8275, 66.555, 65.27000000000001, 65.835, 65.53, 65.44999999999999, 65.22, 65.73, 65.92, 65.5125, 65.815, 66.075, 65.4725, 65.035, 64.36500000000001, 64.225, 64.8025, 64.3175, 63.980000000000004, 63.0625, 63.377500000000005, 63.74999999999999, 63.75, 64.43, 64.4475, 65.06, 64.5025, 65.30000000000001, 66.0275, 65.6525, 67.70500000000001, 69.0375, 69.045, 68.9625, 69.99000000000001, 77.3125, 76.25750000000001, 75.655, 75.5075, 76.215, 77.715, 78.1075, 76.2625, 75.575, 75.255, 74.4375, 74.05000000000001, 73.405, 72.7375, 73.9525, 74.0575, 74.52000000000001, 75.075, 75.1825, 74.7325, 73.8325, 74.1625, 74.4475, 71.655, 71.245, 70.8175, 70.06, 69.32249999999999, 68.23750000000001, 70.215, 69.7325, 70.6075, 70.8075, 71.27, 70.695, 69.9225, 68.8675, 67.65, 68.465, 68.0625, 67.7525, 68.11500000000001, 68.765, 69.2625, 69.995, 71.0725, 71.16, 71.91, 72.11, 72.575, 72.905, 73.6375, 73.7625, 72.725, 73.035, 71.48, 68.545, 68.0625, 64.63250000000001, 66.465, 65.7525, 66.0175, 66.9625, 67.43, 67.425, 66.00999999999999, 66.1, 66.5325, 67.07, 66.7575, 66.205, 65.955, 66.0325, 66.705, 67.225, 67.48750000000001, 67.405, 67.9875, 68.8875, 69.39750000000001, 70.25, 70.8525, 70.51, 69.85749999999999, 70.225, 70.0475, 71.245, 71.495, 71.9525, 71.79, 72.22999999999999, 70.9875, 70.08250000000001, 70.0175, 69.1675, 68.6525, 68.2475, 68.085, 68.5475, 68.36, 68.53, 68.4725, 68.92, 69.49, 70.2475, 70.385, 70.21000000000001, 70.295, 69.9075, 69.8, 71.1175, 71.95, 71.8775, 71.49, 70.405, 70.0925, 70.3025, 70.015, 69.1825, 68.7625, 73.5725, 75.74000000000001, 76.21, 75.0725, 75.6875, 75.955, 75.6925, 75.4025, 76.03, 76.13, 75.9075, 75.9925, 75.17500000000001, 74.21000000000001, 74.41499999999999, 74.3375, 74.695, 75.815, 77.25, 77.8225, 77.2325, 76.2575, 75.28, 74.6525, 73.9325, 73.27000000000001, 72.60999999999999, 72.9525, 73.16, 73.2425, 73.4675, 74.325, 74.0075, 73.895, 75.2025, 75.495, 77.525, 77.8075, 77.9025, 77.85249999999999, 76.0925, 75.71000000000001, 75.48, 74.97749999999999, 75.255, 75.7975, 75.5075, 75.50999999999999, 75.38749999999999, 75.1725, 74.3325, 74.88, 75.80250000000001, 76.8575, 76.685, 76.435, 75.465, 74.72, 74.41999999999999, 73.125, 71.73750000000001, 72.0275, 72.54, 72.9125, 73.9075, 74.365, 74.465, 71.86250000000001, 72.7875, 72.21499999999999, 72.89750000000001, 76.30250000000001, 78.9775, 78.685, 81.9925, 83.4775, 83.5375, 82.5125, 81.6575, 82.595, 82.33500000000001, 83.60249999999999, 83.2575, 82.25, 82.12, 82.6925, 83.715, 85.10749999999999, 84.39750000000001, 85.965, 85.645, 86.45, 86.2425, 84.63, 87.1225, 86.225, 84.985, 84.44, 79.57750000000001, 80.01249999999999, 77.425, 79.4025, 79.415, 75.03999999999999, 76.105, 76.19, 75.9275, 76.1225, 77.4, 76.945, 77.0125, 77.6025, 78.86, 79.205, 78.9925, 79.255, 78.78, 82.04, 80.92, 78.9, 79.21000000000001, 78.125, 77.7825, 77.145, 77.28, 76.88499999999999, 79.265, 81.35249999999999, 81.7025, 83.6675, 85.91999999999999, 86.4125, 87.79, 88.96000000000001, 88.8175, 88.8575, 89.19, 88.91499999999999, 88.79750000000001, 88.39750000000001, 88.92750000000001, 90.13, 90.07, 90.5375, 90.47500000000001, 90.405, 90.715, 90.9975, 92.34, 94.47749999999999, 95.6975, 97.77499999999999, 98.42500000000001, 97.505, 99.0675, 100.77000000000001, 102.32499999999999, 102.71000000000001, 104.6, 103.925, 103.4325, 102.305, 103.215, 102.22999999999999, 102.0625, 101.0675, 101.9, 101.435, 102.2875, 101.625, 102.24, 102.08, 104.3225, 106.64500000000001, 103.7475, 102.62, 103.5975, 104.9425, 103.9075, 103.8725, 103.98, 102.84, 103.28999999999999, 102.58250000000001, 102.35, 101.785, 103.9925, 101.82499999999999, 92.79749999999999, 90.1925, 94.045, 95.52749999999999, 95.98750000000001, 95.0475, 95.73750000000001, 94.9725, 94.17, 94.33250000000001, 94.88749999999999, 96.6575, 97.24, 96.9, 98.765, 97.905, 97.47999999999999, 99.0125, 99.2525, 99.6, 100.755, 102.705, 102.92500000000001, 104.5575, 105.4875, 106.09, 105.42750000000001, 102.275, 99.67500000000001, 98.8225, 100.61249999999998, 100.11749999999999, 99.9025, 101.21, 99.26, 98.26, 98.3725, 99.2875, 98.79499999999999, 98.4075, 98.72749999999999, 98.515, 99.5975, 99.955, 100.035, 100.86, 101.3475, 101.25750000000001, 99.5625, 99.9025, 100.7775, 98.86, 95.4025, 97.45750000000001, 96.88, 98.1675, 99.31750000000001, 98.385, 101.72749999999999, 101.6825, 102.7525, 100.0425, 99.41999999999999, 102.675, 102.10000000000001, 102.745, 105.03500000000001, 106.595, 102.4, 101.4575, 101.9425, 103.7175, 104.11250000000001, 101.6575, 98.6125, 96.04749999999999, 95.35, 96.8425, 97.67250000000001, 96.215, 91.775, 91.365, 90.1925, 90.325, 92.16, 93.675, 93.5475, 91.745, 93.52499999999999, 94.4525, 91.55000000000001, 90.10249999999999, 90.53999999999999, 91.35749999999999, 92.725, 94.7475, 94.09, 93.755, 91.82749999999999, 91.0025, 89.2575, 84.01249999999999, 81.1275, 82.74249999999999, 83.7175, 83.5375, 83.38499999999999, 83.02, 78.6575, 79.57499999999999, 81.4025, 83.1775, 84.3375, 84.78, 85.3225, 84.13, 84.72749999999999, 85.42500000000001, 85.215, 85.57499999999999, 86.17500000000001, 84.72999999999999, 82.32499999999999, 84.57, 85.935, 86.48, 87.5925, 88.72999999999999, 90.25, 91.1825, 92.83500000000001, 92.75999999999999, 91.30499999999999, 87.5625, 86.5575, 87.3425, 87.315, 88.29, 87.935, 87.9025, 89.3475, 89.295, 89.3125, 90.3475, 90.8325, 90.2275, 89.1575, 89.8725, 89.8325, 88.9825, 89.58000000000001, 88.925, 88.0275, 89.505, 90.3275, 90.6775, 91.46249999999999, 92.01, 93.315, 92.82249999999999, 93.41, 96.4525, 95.83250000000001, 95.755, 94.7775, 95.7875, 95.43, 96.38749999999999, 96.58000000000001, 98.275, 99.3675, 100.05250000000001, 100.45, 101.775, 101.405, 102.655, 101.8975, 102.2975, 102.16749999999999, 102.7125, 103.4925, 104.555, 104.5325, 105.36, 110.81, 109.66, 108.17500000000001, 108.8125, 109.0875, 111.42, 109.95750000000001, 111.1175, 111.89999999999999, 107.13499999999999, 106.345, 105.89, 105.685, 102.49, 101.155, 102.25, 102.97999999999999, 102.72, 100.4725, 100.72, 99.865, 99.645, 97.82249999999999, 97.63749999999999, 96.29499999999999, 95.595, 95.2975, 93.315, 92.97, 95.58500000000001, 95.63499999999999, 95.5775, 98.065, 97.1525, 96.17750000000001, 97.3775, 93.58500000000001, 93.5325, 94.42249999999999, 95.5875, 96.245, 95.785, 95.665, 95.7025, 96.62, 97.33500000000001, 96.08, 97.17750000000001, 97.9725, 98.5925, 98.1375, 98.415, 98.86000000000001, 101.67750000000001, 101.5175, 101.57500000000002, 102.9225, 103.38499999999999, 101.8475, 102.095, 101.22749999999999, 101.01500000000001, 106.8, 106.1275, 106.48499999999999, 106.965, 110.35, 111.525, 111.87, 111.20750000000001, 110.185, 108.695, 106.94999999999999, 109.22999999999999, 110.8175, 110.4075, 109.03, 109.4925, 109.42750000000001, 108.185, 109.205, 110.6475, 112.52000000000001, 113.0, 113.585, 110.25, 109.6225, 110.72999999999999, 112.4625, 113.48249999999999, 114.42500000000001, 113.805, 113.51750000000001, 117.01, 119.265, 120.0525, 119.63499999999999, 118.8575, 119.2013, 118.6375, 118.505, 119.755, 120.92250000000001, 121.14000000000001, 120.5625, 121.57999999999998, 121.43, 121.1575, 120.54249999999999, 120.235, 120.83250000000001, 121.06750000000001, 118.21000000000001, 118.325, 121.5625, 123.535, 122.84, 121.9875, 121.2925, 122.33250000000001, 123.86749999999999, 122.50999999999999, 123.4125, 124.0, 123.4525, 122.3175, 122.05000000000001, 121.755, 122.565, 114.985, 115.46249999999999, 113.2925, 113.08500000000001, 113.27, 115.685, 115.69500000000001, 115.68249999999999, 115.7, 116.41749999999999, 115.68499999999999, 116.62, 116.72999999999999, 116.8575, 116.52999999999999, 117.1, 117.94500000000001, 117.8925, 116.8375, 115.5425, 116.35499999999999, 117.9825, 118.35249999999999, 120.22999999999999, 120.5725, 119.36, 118.8125, 118.605, 118.835, 120.4075, 120.57, 120.64000000000001, 121.7225, 122.54499999999999, 123.55749999999999, 125.215, 125.3725, 124.455, 125.565, 127.36, 128.5, 127.8175, 129.66750000000002, 130.82, 131.42, 131.5525, 133.91750000000002, 133.2975, 134.01000000000002, 132.9675, 135.0075, 137.5075, 137.8025, 138.98, 137.86, 137.975, 140.1, 141.7025, 142.02249999999998, 141.965, 150.32750000000001, 152.4375, 153.5975, 153.4725, 156.04500000000002, 157.4575, 152.8175, 149.035, 153.5725, 155.4925, 156.6825, 159.96749999999997, 162.7975, 156.9625, 155.99, 156.4675, 158.6975, 157.09, 158.04500000000002, 158.115, 157.9425, 155.145, 152.2, 153.6325, 147.29999999999998, 146.91, 153.9325, 152.57, 155.115, 156.72, 155.1775, 148.10250000000002, 153.245, 153.16750000000002, 142.5075, 149.4225, 143.17249999999999, 138.855, 137.4975, 134.845, 134.69, 133.0325, 138.77, 139.32, 142.32, 138.495, 137.2525, 140.39249999999998, 134.1375, 134.6225, 132.9625, 139.0175, 139.60750000000002, 144.5675, 147.58749999999998, 150.4625, 155.4225, 152.4775, 148.2125, 147.56, 146.3225, 146.3025, 149.175, 150.76749999999998, 152.2525, 152.82250000000002, 148.595, 153.8525, 157.48, 157.7975, 160.0, 161.88, 161.5375, 167.255, 170.0825, 171.48250000000002, 170.1425, 168.2925, 167.485, 168.2975, 170.45999999999998, 170.79500000000002, 175.20749999999998, 174.8525, 182.51250000000002, 181.2725, 176.79749999999999, 178.2925, 177.755, 175.94250000000002, 172.745, 171.25, 172.89, 169.48499999999999, 174.535, 177.70749999999998, 183.75, 181.805, 181.47, 181.3775, 186.07999999999998, 181.01749999999998, 180.63250000000002, 179.62, 178.3875, 175.61249999999998, 174.335, 174.54, 169.3475, 169.10500000000002, 172.98000000000002, 175.3075, 175.9475, 181.2125, 185.7425, 191.53250000000003, 194.3625, 194.08, 193.31750000000002, 192.8875, 195.995, 193.4425, 192.04749999999999, 192.6575, 192.36, 191.33249999999998, 191.08499999999998, 191.075, 192.85999999999999, 192.14249999999998, 193.93, 195.17, 202.15, 201.1175, 200.125, 199.0025, 205.3925, 200.9425, 203.15750000000003, 198.375, 201.25, 205.44, 206.6375, 205.8675, 207.4425, 210.7875, 213.77499999999998, 223.45000000000002, 224.26749999999998, 225.90500000000003, 228.14249999999998, 228.20999999999998]





@dashboard_routes.route('/stockprices', methods=['POST'])
# @login_required
def stockprices():
    stocks = request.json['stock']

    def get_daily_historical_data(symbols):
        stockinfo = {}
        for i in symbols:
            ticker = i
            iex_api_key = 'pk_7f972a2636b841c489f3cf32f9a06575'
            api_url = f'https://cloud.iexapis.com/stable/stock/{ticker}/intraday-prices?token={iex_api_key}'
            df = requests.get(api_url).json()
            prices = []
            for i in range(len(df)):
                prices.append(df[i]['average'])
            stockinfo[ticker] = {'prices': prices}
        return stockinfo

    get_daily_historical_data(stocks)

    # REDUX STORE ROUTE

    # const handleClick = async () => {
    #     await fetch('/api/dashboard/stockinfo', {
    #         method: 'POST',
    #         headers: {
    #             'Content-Type':'application/json'
    #         },
    #         body: JSON.stringify({
    #             stock: ['SNAP', 'AAPL', 'TWTR']
    #         }),
    #     })
    # }
